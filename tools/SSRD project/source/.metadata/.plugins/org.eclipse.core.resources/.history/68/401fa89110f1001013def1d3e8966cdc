package net.SubSpace.SSDR.Server.Main;

import java.net.*;
import java.util.Random;
import java.io.*;
 
public class ServerThread extends Thread {
    private Socket socket = null;
    Random random = new Random();
 
    public ServerThread(Socket socket) {
    super("ServerThread");
    this.socket = socket;
    }
 
    public void run() {
    	Boolean Connect = false;
    	try {
			ServerSocket servsock = new ServerSocket(40000 + random.nextInt(100));
			Connect = true;
		} catch (IOException e1) {
			try {
				ServerSocket servsock = new ServerSocket(40000 + random.nextInt(100));
				Connect = true;
			} catch (IOException e) {
				// TODO Auto-generated catch block
				try {
					ServerSocket servsock = new ServerSocket(40000 + random.nextInt(100));
					Connect = true;
				} catch (IOException e2) {
					Connect = false;
				}
			}
			e1.printStackTrace();
		}
    	while (Connect) {
    		
    	try {
			SendFile();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
    	}
    }
    
    
    
    public void SendFile() throws IOException
    {
    	File myFile = new File ("source.pdf");
        byte [] mybytearray  = new byte [(int)myFile.length()];
        FileInputStream fis = new FileInputStream(myFile);
        BufferedInputStream bis = new BufferedInputStream(fis);
        bis.read(mybytearray,0,mybytearray.length);
        OutputStream os = socket.getOutputStream();
        System.out.println("Sending...");
        os.write(mybytearray,0,mybytearray.length);
        os.flush();
        socket.close();
    }
}